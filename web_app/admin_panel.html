<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ - –ü–æ—á—Ç–æ–≤–æ–µ –ë—é—Ä–æ</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        header {
            background: #4a5568;
            color: white;
            padding: 20px;
            text-align: center;
        }

        header h1 {
            margin-bottom: 10px;
        }

        main {
            padding: 20px;
        }

        .admin-menu {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .admin-menu button {
            flex: 1;
            min-width: 120px;
            padding: 12px;
            background: #4299e1;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: background 0.3s;
        }

        .admin-menu button:hover {
            background: #3182ce;
        }

        .admin-menu button.active {
            background: #2b6cb0;
        }

        .admin-section {
            display: none;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-top: 20px;
        }

        .admin-section.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .orders-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            overflow-x: auto;
            display: block;
        }

        .orders-table th,
        .orders-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
            min-width: 120px;
        }

        .orders-table th {
            background-color: #f2f2f2;
            font-weight: bold;
            position: sticky;
            top: 0;
        }

        .orders-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }

        .status-pending { background-color: #fff3cd; color: #856404; }
        .status-met { background-color: #d1ecf1; color: #0c5460; }
        .status-delivered { background-color: #d4edda; color: #155724; }
        .status-cancelled { background-color: #f8d7da; color: #721c24; }

        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
        }

        .action-buttons button {
            padding: 6px 12px;
            font-size: 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-warning { background: #ffc107; color: black; }
        .btn-info { background: #17a2b8; color: white; }

        .stats-container {
            text-align: center;
            margin: 20px 0;
        }

        .stats-container img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 8px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.4);
        }

        .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 8px;
            position: relative;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 10px;
        }

        .close:hover {
            color: black;
        }

        .time-window, .location-item {
            background: #f7fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .time-window:hover, .location-item:hover {
            background: #ebf8ff;
            border-color: #4299e1;
            transform: translateY(-2px);
        }

        .time-window.selected, .location-item.selected {
            background: #4299e1;
            color: white;
            border-color: #3182ce;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-align: center;
        }

        .stat-card h3 {
            color: #666;
            margin-bottom: 10px;
        }

        .stat-card p {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }

        .order-details {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .order-details h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .order-details-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .order-detail-item {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 5px;
        }

        .order-detail-item strong {
            display: block;
            color: #666;
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .admin-menu {
                flex-direction: column;
            }
            
            .admin-menu button {
                width: 100%;
            }
            
            .orders-table {
                font-size: 14px;
            }
            
            .orders-table th,
            .orders-table td {
                padding: 8px;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .action-buttons button {
                width: 100%;
                margin-bottom: 5px;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 5px;
            }
            
            .container {
                border-radius: 10px;
            }
            
            header {
                padding: 15px 10px;
            }
            
            main {
                padding: 15px 10px;
            }
            
            .admin-section {
                padding: 15px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üëë –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h1>
            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ü–æ—á—Ç–æ–≤—ã–º –ë—é—Ä–æ</p>
        </header>
        
        <main>
            <div class="admin-menu">
                <button onclick="showSection('dashboard')" class="active">üéõÔ∏è –î–∞—à–±–æ—Ä–¥</button>
                <button onclick="showSection('time-ranges')">üïê –í—Ä–µ–º—è</button>
                <button onclick="showSection('locations')">üìç –õ–æ–∫–∞—Ü–∏–∏</button>
                <button onclick="showSection('orders')">üìã –ó–∞–∫–∞–∑—ã</button>
                <button onclick="showSection('stats')">üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</button>
            </div>
            
            <!-- –î–∞—à–±–æ—Ä–¥ -->
            <div id="dashboard" class="admin-section active">
                <h2>üìä –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã</h2>
                <div class="stats-grid" id="dashboard-stats">
                    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω–∞ —Å—é–¥–∞ -->
                </div>
                
                <div class="recent-orders">
                    <h3>–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã</h3>
                    <div id="recent-orders-list"></div>
                </div>
            </div>
            
            <!-- –í—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã -->
            <div id="time-ranges" class="admin-section">
                <h2>üïê –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–∞–º–∏</h2>
                
                <div class="form-section">
                    <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω</h3>
                    <div class="form-group">
                        <label>–î–∞—Ç–∞:</label>
                        <input type="date" id="rangeDate" min="">
                    </div>
                    
                    <div class="form-group">
                        <label>–ù–∞—á–∞–ª–æ:</label>
                        <input type="time" id="rangeStart">
                    </div>
                    
                    <div class="form-group">
                        <label>–ö–æ–Ω–µ—Ü:</label>
                        <input type="time" id="rangeEnd">
                    </div>
                    
                    <div class="form-group">
                        <label>–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ–∫–Ω–∞ (–º–∏–Ω—É—Ç—ã):</label>
                        <input type="number" id="windowDuration" min="5" max="60" value="15">
                    </div>
                    
                    <div class="form-group">
                        <label>–ú–∞–∫—Å–∏–º—É–º –≤—Å—Ç—Ä–µ—á –≤ –æ–∫–Ω–µ:</label>
                        <input type="number" id="maxMeetings" min="1" max="10" value="1">
                    </div>
                    
                    <button onclick="addTimeRange()" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω</button>
                </div>
                
                <div id="ranges-list">
                    <h3>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω—ã:</h3>
                    <div id="ranges-container"></div>
                </div>
            </div>
            
            <!-- –õ–æ–∫–∞—Ü–∏–∏ -->
            <div id="locations" class="admin-section">
                <h2>üìç –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–∫–∞—Ü–∏—è–º–∏</h2>
                
                <div class="form-section">
                    <h3>–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –ª–æ–∫–∞—Ü–∏—é</h3>
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ:</label>
                        <input type="text" id="locationName" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏">
                    </div>
                    
                    <div class="form-group">
                        <label>–ê–¥—Ä–µ—Å:</label>
                        <input type="text" id="locationAddress" placeholder="–ê–¥—Ä–µ—Å –ª–æ–∫–∞—Ü–∏–∏">
                    </div>
                    
                    <button onclick="addLocation()" class="btn-primary">–î–æ–±–∞–≤–∏—Ç—å –ª–æ–∫–∞—Ü–∏—é</button>
                </div>
                
                <div id="locations-list">
                    <h3>–°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ª–æ–∫–∞—Ü–∏–∏:</h3>
                    <div id="locations-container"></div>
                </div>
            </div>
            
            <!-- –ó–∞–∫–∞–∑—ã -->
            <div id="orders" class="admin-section">
                <h2>üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞–º–∏</h2>
                
                <div class="form-group">
                    <label>–§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É:</label>
                    <select id="statusFilter" onchange="loadOrders()">
                        <option value="">–í—Å–µ</option>
                        <option value="pending">–û–∂–∏–¥–∞–µ—Ç</option>
                        <option value="met">–í—Å—Ç—Ä–µ—á–∞ —Å–æ—Å—Ç–æ—è–ª–∞—Å—å</option>
                        <option value="delivered">–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</option>
                        <option value="cancelled">–û—Ç–º–µ–Ω–µ–Ω–æ</option>
                    </select>
                </div>
                
                <div style="overflow-x: auto;">
                    <table class="orders-table">
                        <thead>
                            <tr>
                                <th>–ú–µ—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∏</th>
                                <th>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (Telegram ID)</th>
                                <th>–ò–º—è –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è</th>
                                <th>–ú–µ—Å—Ç–æ –¥–æ—Å—Ç–∞–≤–∫–∏</th>
                                <th>–í—Ä–µ–º—è –≤—Å—Ç—Ä–µ—á–∏</th>
                                <th>–û—Ç–∫—Ä—ã—Ç–∫–∏</th>
                                <th>–°—Ç–∞—Ç—É—Å</th>
                                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
                            </tr>
                        </thead>
                        <tbody id="orders-tbody">
                            <!-- –ó–∞–∫–∞–∑—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ -->
            <div id="stats" class="admin-section">
                <h2>üìà –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</h2>
                <div class="stats-container" id="stats-container">
                    <!-- –ì—Ä–∞—Ñ–∏–∫–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —Å—é–¥–∞ -->
                </div>
            </div>
        </main>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞ -->
    <div id="cancelModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeCancelModal()">&times;</span>
            <h3>–û—Ç–º–µ–Ω–∞ –∑–∞–∫–∞–∑–∞</h3>
            <div class="form-group">
                <label>–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–º–µ–Ω—ã:</label>
                <textarea id="cancelReason" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã" rows="4"></textarea>
            </div>
            <button onclick="confirmCancelOrder()" class="btn-danger">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ—Ç–º–µ–Ω—É</button>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞ -->
    <div id="orderDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeOrderDetailsModal()">&times;</span>
            <h3>–î–µ—Ç–∞–ª–∏ –∑–∞–∫–∞–∑–∞</h3>
            <div id="order-details-content"></div>
        </div>
    </div>
    
    <script>
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        let currentOrderIdForCancel = null;
        let refreshNeeded = false;
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('rangeDate').min = today;
            document.getElementById('rangeDate').value = today;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
            loadDashboardStats();
            loadTimeRanges();
            loadLocations();
            loadOrders();
            loadStats();
        });
        
        function showSection(sectionId) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å–µ–∫—Ü–∏–∏
            document.querySelectorAll('.admin-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.admin-menu button').forEach(button => {
                button.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å–µ–∫—Ü–∏—é
            document.getElementById(sectionId).classList.add('active');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –∫–Ω–æ–ø–∫–µ
            event.target.classList.add('active');
            
            // –ï—Å–ª–∏ –Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ
            if (refreshNeeded) {
                switch(sectionId) {
                    case 'dashboard':
                        loadDashboardStats();
                        break;
                    case 'time-ranges':
                        loadTimeRanges();
                        break;
                    case 'locations':
                        loadLocations();
                        break;
                    case 'orders':
                        loadOrders();
                        break;
                    case 'stats':
                        loadStats();
                        break;
                }
                refreshNeeded = false;
            }
        }
        
        async function loadDashboardStats() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();
                
                const statsContainer = document.getElementById('dashboard-stats');
                statsContainer.innerHTML = `
                    <div class="stat-card">
                        <h3>–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</h3>
                        <p>${stats.total_orders || 0}</p>
                    </div>
                    <div class="stat-card">
                        <h3>–ê–∫—Ç–∏–≤–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á</h3>
                        <p>${stats.active_meetings || 0}</p>
                    </div>
                    <div class="stat-card">
                        <h3>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π</h3>
                        <p>${stats.total_users || 0}</p>
                    </div>
                    <div class="stat-card">
                        <h3>–°—Ä–µ–¥–Ω–∏–π —Ä–µ–π—Ç–∏–Ω–≥</h3>
                        <p>${stats.avg_rating || 0}</p>
                    </div>
                `;
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã
                await loadRecentOrders();
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }
        
        async function loadRecentOrders() {
            try {
                const response = await fetch('/api/orders?limit=5');
                const orders = await response.json();
                
                const container = document.getElementById('recent-orders-list');
                if (orders.length === 0) {
                    container.innerHTML = '<p>–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>';
                    return;
                }
                
                let html = '<div class="order-details-grid">';
                orders.forEach(order => {
                    let cardsInfo = '';
                    if (order.card_type_1_count > 0) cardsInfo += `–ö—Ä–∞—Å–Ω—ã–µ: ${order.card_type_1_count} `;
                    if (order.card_type_2_count > 0) cardsInfo += `–°–∏–Ω–∏–µ: ${order.card_type_2_count} `;
                    if (order.card_type_3_count > 0) cardsInfo += `–ó–µ–ª–µ–Ω—ã–µ: ${order.card_type_3_count} `;
                    
                    const userInfo = order.telegram_id ? 
                        `${order.user || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'} (${order.telegram_id})` : 
                        (order.user || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π');
                    
                    html += `
                        <div class="order-detail-item">
                            <strong>–ó–∞–∫–∞–∑ #${order.id}</strong>
                            <div>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${userInfo}</div>
                            <div>–í—Ä–µ–º—è: ${order.window_start} - ${order.window_end}</div>
                            <div>–°—Ç–∞—Ç—É—Å: ${getStatusText(order.status)}</div>
                        </div>
                    `;
                });
                html += '</div>';
                
                container.innerHTML = html;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–∫–∞–∑–æ–≤:', error);
            }
        }
        
        async function loadTimeRanges() {
            try {
                const response = await fetch('/api/time-ranges');
                const ranges = await response.json();
                displayTimeRanges(ranges);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤:', error);
                document.getElementById('ranges-container').innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>';
            }
        }
        
        function displayTimeRanges(ranges) {
            const container = document.getElementById('ranges-container');
            container.innerHTML = '';
            
            if (ranges.length === 0) {
                container.innerHTML = '<p>–ù–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –¥–∏–∞–ø–∞–∑–æ–Ω–æ–≤</p>';
                return;
            }
            
            // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω—ã –ø–æ –¥–∞—Ç–∞–º
            const rangesByDate = {};
            ranges.forEach(range => {
                if (!rangesByDate[range.date]) {
                    rangesByDate[range.date] = [];
                }
                rangesByDate[range.date].push(range);
            });
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω—ã –ø–æ –¥–∞—Ç–∞–º
            Object.keys(rangesByDate).sort().forEach(date => {
                const dateRanges = rangesByDate[date];
                const dateObj = new Date(date);
                const formattedDate = dateObj.toLocaleDateString('ru-RU', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                
                const dateContainer = document.createElement('div');
                dateContainer.innerHTML = `<h4>${formattedDate}</h4>`;
                container.appendChild(dateContainer);
                
                dateRanges.forEach(range => {
                    const rangeElement = document.createElement('div');
                    rangeElement.className = 'time-window';
                    rangeElement.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${range.start_time}-${range.end_time}</strong><br>
                                <small>–û–∫–Ω–æ: ${range.window_duration_min} –º–∏–Ω, –ú–∞–∫—Å: ${range.max_meetings_per_window}</small>
                            </div>
                            <div>
                                <button onclick="deleteTimeRange(${range.id})" class="btn-danger" style="margin-right: 5px;">–£–¥–∞–ª–∏—Ç—å</button>
                                <button onclick="toggleTimeRange(${range.id}, ${range.is_active})" class="${range.is_active ? 'btn-success' : 'btn-warning'}">
                                    ${range.is_active ? '–ê–∫—Ç–∏–≤–µ–Ω' : '–ù–µ–∞–∫—Ç–∏–≤–µ–Ω'}
                                </button>
                            </div>
                        </div>
                    `;
                    container.appendChild(rangeElement);
                });
            });
        }
        
        async function addTimeRange() {
            const date = document.getElementById('rangeDate').value;
            const start = document.getElementById('rangeStart').value;
            const end = document.getElementById('rangeEnd').value;
            const duration = document.getElementById('windowDuration').value;
            const maxMeetings = document.getElementById('maxMeetings').value;
            
            if (!date || !start || !end) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            try {
                const response = await fetch('/api/time-ranges', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        date: date,
                        start_time: start,
                        end_time: end,
                        window_duration_min: parseInt(duration),
                        max_meetings_per_window: parseInt(maxMeetings)
                    })
                });
                
                if (response.ok) {
                    alert('–î–∏–∞–ø–∞–∑–æ–Ω –¥–æ–±–∞–≤–ª–µ–Ω —É—Å–ø–µ—à–Ω–æ');
                    loadTimeRanges();
                    loadDashboardStats();
                    refreshNeeded = true;
                } else {
                    const error = await response.json();
                    alert(error.error || '–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞:', error);
                alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞');
            }
        }
        
        async function deleteTimeRange(rangeId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –¥–∏–∞–ø–∞–∑–æ–Ω?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/time-ranges/${rangeId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('–î–∏–∞–ø–∞–∑–æ–Ω —É–¥–∞–ª–µ–Ω');
                    loadTimeRanges();
                    loadDashboardStats();
                    refreshNeeded = true;
                } else {
                    const error = await response.json();
                    alert(error.error || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞:', error);
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–∏–∞–ø–∞–∑–æ–Ω–∞');
            }
        }
        
        async function toggleTimeRange(rangeId, currentStatus) {
            try {
                const response = await fetch(`/api/time-ranges/${rangeId}/toggle`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        is_active: !currentStatus
                    })
                });
                
                if (response.ok) {
                    alert('–°—Ç–∞—Ç—É—Å –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω');
                    loadTimeRanges();
                    refreshNeeded = true;
                } else {
                    const error = await response.json();
                    alert(error.error || '–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞:', error);
                alert('–û—à–∏–±–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –¥–∏–∞–ø–∞–∑–æ–Ω–∞');
            }
        }
        
        async function loadLocations() {
            try {
                const response = await fetch('/api/locations');
                const locations = await response.json();
                displayLocations(locations);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–∫–∞—Ü–∏–π:', error);
                document.getElementById('locations-container').innerHTML = '<p>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</p>';
            }
        }
        
        function displayLocations(locations) {
            const container = document.getElementById('locations-container');
            container.innerHTML = '';
            
            if (locations.length === 0) {
                container.innerHTML = '<p>–ù–µ—Ç –ª–æ–∫–∞—Ü–∏–π</p>';
                return;
            }
            
            locations.forEach(location => {
                const locationElement = document.createElement('div');
                locationElement.className = 'location-item';
                locationElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <strong>${location.name}</strong><br>
                            <small>${location.address}</small>
                        </div>
                        <button onclick="deleteLocation(${location.id})" class="btn-danger">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                `;
                container.appendChild(locationElement);
            });
        }
        
        async function addLocation() {
            const name = document.getElementById('locationName').value;
            const address = document.getElementById('locationAddress').value;
            
            if (!name || !address) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è');
                return;
            }
            
            try {
                const response = await fetch('/api/locations', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name,
                        address: address
                    })
                });
                
                if (response.ok) {
                    alert('–õ–æ–∫–∞—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ');
                    loadLocations();
                    document.getElementById('locationName').value = '';
                    document.getElementById('locationAddress').value = '';
                    loadDashboardStats();
                    refreshNeeded = true;
                } else {
                    const error = await response.json();
                    alert(error.error || '–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏:', error);
                alert('–û—à–∏–±–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏');
            }
        }
        
        async function deleteLocation(locationId) {
            if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç—É –ª–æ–∫–∞—Ü–∏—é?')) {
                return;
            }
            
            try {
                const response = await fetch(`/api/locations/${locationId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    alert('–õ–æ–∫–∞—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞');
                    loadLocations();
                    loadDashboardStats();
                    refreshNeeded = true;
                } else {
                    const error = await response.json();
                    alert(error.error || '–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏:', error);
                alert('–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –ª–æ–∫–∞—Ü–∏–∏');
            }
        }
        
        async function loadOrders() {
            const status = document.getElementById('statusFilter').value;
            
            try {
                let url = '/api/orders';
                if (status) {
                    url += `?status=${status}`;
                }
                
                const response = await fetch(url);
                const orders = await response.json();
                displayOrders(orders);
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–∫–∞–∑–æ–≤:', error);
                document.getElementById('orders-tbody').innerHTML = '<tr><td colspan="8">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>';
            }
        }
        
        function displayOrders(orders) {
            const tbody = document.getElementById('orders-tbody');
            tbody.innerHTML = '';
            
            if (orders.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</td></tr>';
                return;
            }
            
            orders.forEach(order => {
                // –§–æ—Ä–º–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É —Å –æ—Ç–∫—Ä—ã—Ç–∫–∞–º–∏
                let cardsInfo = '';
                if (order.card_type_1_count > 0) cardsInfo += `–ö—Ä–∞—Å–Ω—ã–µ: ${order.card_type_1_count} `;
                if (order.card_type_2_count > 0) cardsInfo += `–°–∏–Ω–∏–µ: ${order.card_type_2_count} `;
                if (order.card_type_3_count > 0) cardsInfo += `–ó–µ–ª–µ–Ω—ã–µ: ${order.card_type_3_count} `;
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
                const userInfo = order.telegram_id ? 
                    `${order.user || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'} (${order.telegram_id})` : 
                    (order.user || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π');
                
                // –§–æ—Ä–º–∏—Ä—É–µ–º –≤—Ä–µ–º—è –≤—Å—Ç—Ä–µ—á–∏
                const timeInfo = order.window_start && order.window_end ? 
                    `${order.window_start} - ${order.window_end}` : '–ù–µ —É–∫–∞–∑–∞–Ω–æ';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${order.location_name || order.custom_location || '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è'}</td>
                    <td>${userInfo}</td>
                    <td>${order.client_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</td>
                    <td>${order.delivery_address || '–ù–µ —É–∫–∞–∑–∞–Ω'}</td>
                    <td>${timeInfo}</td>
                    <td>${cardsInfo || '–ù–µ—Ç'}</td>
                    <td><span class="status-badge status-${order.status}">${getStatusText(order.status)}</span></td>
                    <td class="action-buttons">
                        <button onclick="viewOrderDetails(${order.id})" class="btn-info">–ü—Ä–æ—Å–º–æ—Ç—Ä</button>
                        <button onclick="markOrderMet(${order.id})" class="btn-warning" ${order.status !== 'pending' ? 'disabled' : ''}>–í—Å—Ç—Ä–µ—á–∞</button>
                        <button onclick="markOrderDelivered(${order.id})" class="btn-success" ${order.status !== 'met' ? 'disabled' : ''}>–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</button>
                        <button onclick="openCancelModal(${order.id})" class="btn-danger" ${order.status === 'cancelled' || order.status === 'delivered' ? 'disabled' : ''}>–û—Ç–º–µ–Ω–∏—Ç—å</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }
        
        function getStatusText(status) {
            const statuses = {
                'pending': '–û–∂–∏–¥–∞–µ—Ç',
                'met': '–í—Å—Ç—Ä–µ—á–∞',
                'delivered': '–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ',
                'cancelled': '–û—Ç–º–µ–Ω–µ–Ω–æ'
            };
            return statuses[status] || status;
        }
        
        async function viewOrderDetails(orderId) {
            try {
                const response = await fetch(`/api/orders/${orderId}`);
                const order = await response.json();
                
                if (!response.ok) {
                    alert(order.error || '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞');
                    return;
                }
                
                const content = document.getElementById('order-details-content');
                content.innerHTML = `
                    <div class="order-details">
                        <h3>–ó–∞–∫–∞–∑ #${order.id}</h3>
                        <div class="order-details-grid">
                            <div class="order-detail-item">
                                <strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</strong>
                                <div>${order.user || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'}</div>
                                <div>Telegram ID: ${order.telegram_id || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                                <div>ID –≤ –ë–î: ${order.user_id}</div>
                            </div>
                            <div class="order-detail-item">
                                <strong>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è</strong>
                                <div>${new Date(order.created_at).toLocaleString('ru-RU')}</div>
                            </div>
                            <div class="order-detail-item">
                                <strong>–°—Ç–∞—Ç—É—Å</strong>
                                <div><span class="status-badge status-${order.status}">${getStatusText(order.status)}</span></div>
                            </div>
                            <div class="order-detail-item">
                                <strong>–í—Ä–µ–º—è –≤—Å—Ç—Ä–µ—á–∏</strong>
                                <div>${order.window_start} - ${order.window_end}</div>
                            </div>
                            <div class="order-detail-item">
                                <strong>–ú–µ—Å—Ç–æ –≤—Å—Ç—Ä–µ—á–∏</strong>
                                <div>${order.location_name || order.custom_location || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</div>
                            </div>
                            <div class="order-detail-item">
                                <strong>–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</strong>
                                <div>${order.delivery_address || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                            </div>
                        </div>
                        
                        <h4>–û—Ç–∫—Ä—ã—Ç–∫–∏</h4>
                        <div class="order-details-grid">
                            <div class="order-detail-item">
                                <strong>–ö—Ä–∞—Å–Ω—ã–µ –æ—Ç–∫—Ä—ã—Ç–∫–∏</strong>
                                <div>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${order.card_type_1_count || 0}</div>
                            </div>
                            <div class="order-detail-item">
                                <strong>–°–∏–Ω–∏–µ –æ—Ç–∫—Ä—ã—Ç–∫–∏</strong>
                                <div>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${order.card_type_2_count || 0}</div>
                            </div>
                            <div class="order-detail-item">
                                <strong>–ó–µ–ª–µ–Ω—ã–µ –æ—Ç–∫—Ä—ã—Ç–∫–∏</strong>
                                <div>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ: ${order.card_type_3_count || 0}</div>
                            </div>
                        </div>
                        
                        <div class="order-details-grid">
                            <div class="order-detail-item">
                                <strong>–ê–Ω–æ–Ω–∏–º–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞</strong>
                                <div>${order.is_anonymous ? '–î–∞' : '–ù–µ—Ç'}</div>
                            </div>
                            <div class="order-detail-item">
                                <strong>–ó–∞–¥–µ—Ä–∂–∫–∞ –¥–æ—Å—Ç–∞–≤–∫–∏</strong>
                                <div>${order.delivery_delay_days || 0} –¥–Ω–µ–π</div>
                            </div>
                            <div class="order-detail-item">
                                <strong>–ü–æ–ª—É—á–∞—Ç–µ–ª—å</strong>
                                <div>${order.recipient_name || '–ù–µ —É–∫–∞–∑–∞–Ω'}</div>
                            </div>
                            <div class="order-detail-item">
                                <strong>–ò–º—è –∫–ª–∏–µ–Ω—Ç–∞</strong>
                                <div>${order.client_name || '–ù–µ —É–∫–∞–∑–∞–Ω–æ'}</div>
                            </div>
                        </div>
                        
                        ${order.cancelled_reason ? `
                            <div class="order-detail-item">
                                <strong>–ü—Ä–∏—á–∏–Ω–∞ –æ—Ç–º–µ–Ω—ã</strong>
                                <div>${order.cancelled_reason}</div>
                            </div>
                        ` : ''}
                    </div>
                `;
                
                document.getElementById('orderDetailsModal').style.display = 'block';
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π –∑–∞–∫–∞–∑–∞');
            }
        }
        
        function closeOrderDetailsModal() {
            document.getElementById('orderDetailsModal').style.display = 'none';
        }
        
        async function markOrderMet(orderId) {
            try {
                const response = await fetch(`/api/orders/${orderId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: 'met'
                    })
                });
                
                if (response.ok) {
                    alert('–í—Å—Ç—Ä–µ—á–∞ –æ—Ç–º–µ—á–µ–Ω–∞');
                    loadOrders();
                    loadDashboardStats();
                    refreshNeeded = true;
                } else {
                    const error = await response.json();
                    alert(error.error || '–û—à–∏–±–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ –≤—Å—Ç—Ä–µ—á–∏');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ –≤—Å—Ç—Ä–µ—á–∏:', error);
                alert('–û—à–∏–±–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ –≤—Å—Ç—Ä–µ—á–∏');
            }
        }
        
        async function markOrderDelivered(orderId) {
            try {
                const response = await fetch(`/api/orders/${orderId}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: 'delivered'
                    })
                });
                
                if (response.ok) {
                    alert('–î–æ—Å—Ç–∞–≤–∫–∞ –æ—Ç–º–µ—á–µ–Ω–∞');
                    loadOrders();
                    loadDashboardStats();
                    refreshNeeded = true;
                } else {
                    const error = await response.json();
                    alert(error.error || '–û—à–∏–±–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏:', error);
                alert('–û—à–∏–±–∫–∞ –æ—Ç–º–µ—Ç–∫–∏ –¥–æ—Å—Ç–∞–≤–∫–∏');
            }
        }
        
        function openCancelModal(orderId) {
            currentOrderIdForCancel = orderId;
            document.getElementById('cancelModal').style.display = 'block';
        }
        
        function closeCancelModal() {
            document.getElementById('cancelModal').style.display = 'none';
            document.getElementById('cancelReason').value = '';
            currentOrderIdForCancel = null;
        }
        
        async function confirmCancelOrder() {
            const reason = document.getElementById('cancelReason').value.trim();
            if (!reason) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –ø—Ä–∏—á–∏–Ω—É –æ—Ç–º–µ–Ω—ã');
                return;
            }
            
            try {
                const response = await fetch(`/api/orders/${currentOrderIdForCancel}/status`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        status: 'cancelled',
                        reason: reason
                    })
                });
                
                if (response.ok) {
                    alert('–ó–∞–∫–∞–∑ –æ—Ç–º–µ–Ω–µ–Ω');
                    closeCancelModal();
                    loadOrders();
                    loadDashboardStats();
                    refreshNeeded = true;
                } else {
                    const error = await response.json();
                    alert(error.error || '–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞');
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞:', error);
                alert('–û—à–∏–±–∫–∞ –æ—Ç–º–µ–Ω—ã –∑–∞–∫–∞–∑–∞');
            }
        }
        
        async function loadStats() {
            try {
                const response = await fetch('/api/stats/chart');
                if (response.ok && response.headers.get('content-type')?.includes('image')) {
                    const blob = await response.blob();
                    const imageUrl = URL.createObjectURL(blob);
                    document.getElementById('stats-container').innerHTML = `
                        <img src="${imageUrl}" alt="–ê–Ω–∞–ª–∏—Ç–∏–∫–∞" style="max-width: 100%; height: auto;">
                    `;
                } else {
                    // –ï—Å–ª–∏ –Ω–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º placeholder
                    document.getElementById('stats-container').innerHTML = `
                        <div style="background: #f8f9fa; padding: 50px; text-align: center; border-radius: 10px;">
                            <h3>–ì—Ä–∞—Ñ–∏–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</h3>
                            <p>–ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –≥—Ä–∞—Ñ–∏–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</p>
                            <p>–î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏:', error);
                document.getElementById('stats-container').innerHTML = `
                    <div style="background: #f8f9fa; padding: 50px; text-align: center; border-radius: 10px;">
                        <h3>–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏</h3>
                        <p>–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏</p>
                    </div>
                `;
            }
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
        window.onclick = function(event) {
            const cancelModal = document.getElementById('cancelModal');
            const orderDetailsModal = document.getElementById('orderDetailsModal');
            
            if (event.target == cancelModal) {
                closeCancelModal();
            }
            
            if (event.target == orderDetailsModal) {
                closeOrderDetailsModal();
            }
        }
    </script>
</body>
</html>